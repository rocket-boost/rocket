<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rocket VPN Redirect</title>
    <script>
        function getQueryParam(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        window.onload = function() {
            const encodedConfig = getQueryParam('enc');
            const isSub = getQueryParam('sub');

            if (!encodedConfig) {
                document.body.innerHTML = "Ошибка: Конфигурация не найдена";
                return;
            }

            // Декодируем ссылку обратно
            const decodedConfig = atob(encodedConfig);
            
            // Определяем устройство
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);

            if (isIOS) {
                // Для iOS (V2Box) используем прямой протокол приложения
                // Мы передаем саму VLESS ссылку (decodedConfig), но её нужно снова закодировать для URL
                const iosUrl = "v2box://install-config?url=" + encodeURIComponent(decodedConfig);
                window.location.href = iosUrl;
            } else {
                // Для Android (Happ VPN) оставляем как было
                window.location.href = decodedConfig;
            }

            // Закрываем окно через пару секунд (для Mini App)
            setTimeout(() => {
                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.close();
                }
            }, 3000);
        };
    </script>
</head>
<body style="background: #0f0c29; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; font-family: sans-serif;">
    <div style="text-align: center;">
        <h2 id="status">Импорт конфигурации...</h2>
        <p>Если приложение не открылось, нажмите кнопку в боте еще раз.</p>
    </div>
</body>
</html>
