<script>
    const urlParams = new URLSearchParams(window.location.search);
    const enc = urlParams.get('enc'); // Здесь теперь зашифрована КОРОТКАЯ ссылка

    async function process() {
        if (!enc) return;

        const subUrl = atob(enc); // Получаем https://твой-домен.com/sub/123.txt
        const isAndroid = /Android/i.test(navigator.userAgent);
        
        let finalAppUrl;
        if (isAndroid) {
            // Команда для Happ: добавить подписку
            finalAppUrl = "happ://add-subscription?url=" + encodeURIComponent(subUrl) + "&name=RocketVPN";
        } else {
            // Команда для V2Box: добавить подписку
            finalAppUrl = "v2box://add-sub?url=" + encodeURIComponent(subUrl) + "&title=RocketVPN";
        }

        // 1. Копируем ссылку в буфер (на всякий случай)
        const el = document.createElement('textarea');
        el.value = subUrl;
        document.body.appendChild(el);
        el.select();
        document.execCommand('copy');
        document.body.removeChild(el);

        // 2. Редирект в приложение
        setTimeout(() => {
            window.location.href = finalAppUrl;
        }, 500);
    }
    window.onload = process;
</script>
